<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base-page-user-access::layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<section>
    <div class="bg-gray-100 font-sans antialiased dynamic-content">

        <div class="loader mt-5 ml-auto mr-auto" id="wifi-loader">
            <p class="heading font-bold text-2xl">Loading Charts</p>
            <div class="loading">
                <div class="load"></div>
                <div class="load"></div>
                <div class="load"></div>
                <div class="load"></div>
            </div>
        </div>



        <div class="flex">

            <!-- Main Content -->
            <div class="flex-1 p-8">
                <div class="mb-6">
                    <h1 class="text-2xl font-bold text-gray-800 animate-slide-fade-in">
                        Financial Reports
                    </h1>
                </div>
                <!-- Tabs -->
                <div id ="buttonGroup" class="flex space-x-4 mb-6">



                    <form id="selectCategoryForm" method="get" th:action="@{/user/reports}" class="animate-fade-in-slow">
                        <button name="period" value="monthly" type="submit"
                                th:class="'mt-5 group relative inline-flex items-center justify-center p-0.5 mb-2 mr-2 text-sm font-medium rounded-lg ' +
              (${period} == 'monthly' ?
               'btn-active bg-gray-800 text-white' :
               'text-black bg-gray-200 hover:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] hover:text-black')">

  <span
          class=" relative px-5 py-2.5 transition-all ease-in duration-200  rounded-md"
  >
    Monthly
  </span>
                            <div
                                    class="ease-in duration-300 opacity-0 group-hover:block group-hover:opacity-100 transition-all"
                            >
                                <div
                                        class=" tooltip-content ease-in-out duration-500 -translate-y-4 pointer-events-none transition-all group-hover:-translate-y-16 absolute left-1/2 z-50 flex -translate-x-1/2 flex-col items-center rounded-sm text-center text-sm text-slate-300"
                                >
                                    <div class="rounded-sm bg-black py-1 px-2">
                                        <p class="whitespace-nowrap">Click to see your monthly reports</p>
                                    </div>
                                    <div class="h-0 w-fit border-l-8 border-r-8 border-t-8 border-transparent border-t-black"></div>
                                </div>
                            </div>
                        </button>




                        <button  name="period" value="quarterly" type="submit"
                                 th:class="'mt-5 group relative inline-flex items-center justify-center p-0.5 mb-2 mr-2 text-sm font-medium rounded-lg ' +
              (${period} == 'quarterly' ?
               'btn-active bg-gray-800 text-white' :
               'text-black bg-gray-200 hover:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] hover:text-black')">
  <span
          class="relative px-5 py-2.5 transition-all ease-in duration-200 bg-transparent rounded-md"
  >
    Quarterly
  </span>
                            <div
                                    class="ease-in duration-300 opacity-0 group-hover:block group-hover:opacity-100 transition-all"
                            >
                                <div
                                        class="tooltip-content ease-in-out duration-500 -translate-y-4 pointer-events-none transition-all group-hover:-translate-y-16 absolute left-1/2 z-50 flex -translate-x-1/2 flex-col items-center rounded-sm text-center text-sm text-slate-300"
                                >
                                    <div class="rounded-sm bg-black py-1 px-2">
                                        <p class="whitespace-nowrap">Click to see your quarterly reports</p>
                                    </div>
                                    <div class="h-0 w-fit border-l-8 border-r-8 border-t-8 border-transparent border-t-black"></div>
                                </div>
                            </div>
                        </button>





                        <button  name="period" value="yearly" type="submit"
                                 th:class="'mt-5 group relative inline-flex items-center justify-center p-0.5 mb-2 mr-2 text-sm font-medium rounded-lg ' +
              (${period} == 'yearly' ?
               'btn-active bg-gray-800 text-white' :
               'text-black bg-gray-200 hover:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] hover:text-black')">
  <span
          class="relative px-5 py-2.5 transition-all ease-in duration-200 bg-transparent rounded-md"
  >
    Yearly
  </span>
                            <div
                                    class="ease-in duration-300 opacity-0 group-hover:block group-hover:opacity-100 transition-all"
                            >
                                <div
                                        class="tooltip-content ease-in-out duration-500 -translate-y-4 pointer-events-none transition-all group-hover:-translate-y-16 absolute left-1/2 z-50 flex -translate-x-1/2 flex-col items-center rounded-sm text-center text-sm text-slate-300"
                                >
                                    <div class="rounded-sm bg-black py-1 px-2">
                                        <p class="whitespace-nowrap">Click to see your yearly reports</p>
                                    </div>
                                    <div class="h-0 w-fit border-l-8 border-r-8 border-t-8 border-transparent border-t-black"></div>
                                </div>
                            </div>
                        </button>


                    </form>




                </div>

                <!-- Spending Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 animate-fade-in-slow">
                    <div class="bg-white p-4 rounded shadow">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-wallet text-teal-400"></i>
                            <span class="text-gray-600 font-bold">Total Expenses for <span th:text="${periodLabel}"></span></span>
                        </div>
                        <div class="text-2xl font-bold text-gray-800" th:text="'₹ ' + ${totalExpense}">--</div>
                    </div>

                    <div class="bg-white p-4 rounded shadow">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-university text-teal-400"></i>
                            <span class="text-gray-600 font-bold">Total Income for <span th:text="${periodLabel}"></span></span>
                        </div>
                        <div class="text-2xl font-bold text-gray-800" th:text="'₹ ' + ${totalIncome}">--</div>
                    </div>

                    <div class="bg-white p-4 rounded shadow">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-piggy-bank text-teal-400"></i>
                            <span class="text-gray-600 font-bold">Net Savings for <span th:text="${periodLabel}"></span></span>
                        </div>
                        <div class="text-2xl font-bold text-gray-800" th:text="'₹ ' + ${netSavings}">--</div>
                    </div>
                </div>

                <!-- Expense Trends -->
                <div class="mb-6 animate-fade-in-slow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        Expense Trends
                    </h2>
                    <div class="bg-white p-4 rounded shadow">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-chart-line text-teal-400">
                            </i>
                            <span class="text-gray-600 font-bold" th:text="${periodLabel2Description}"> Expense Trend  </span>
                        </div>
                        <div class="text-gray-500" th:text="${periodTrendDescription}">
                            Line chart showing expense trend
                        </div>

                        <button
                                id="toggleChartBtn"
                                type="button"
                                class="flex justify-center gap-2 mt-2 items-center shadow-lg text-base bg-gray-200 backdrop-blur-md font-semibold isolation-auto border-gray-50 relative z-10 px-3.5 py-1.5 overflow-hidden border-2 rounded-full group
        before:absolute before:w-full before:transition-all before:duration-700 before:hover:w-full before:-left-full before:hover:left-0
        before:rounded-full before:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] before:-z-10 before:aspect-square before:hover:scale-150"
                        >
                            <span id="toggleChartText">Click to hide</span>
                            <svg
                                    class="w-6 h-6 justify-end group-hover:rotate-90 group-hover:bg-gray-50 text-gray-50 ease-linear duration-300 rounded-full border border-gray-700 group-hover:border-none p-1.5 rotate-45"
                                    viewBox="0 0 16 19"
                                    xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                        d="M7 18C7 18.5523 7.44772 19 8 19C8.55228 19 9 18.5523 9 18H7ZM8.70711 0.292893C8.31658 -0.0976311 7.68342 -0.0976311 7.29289 0.292893L0.928932 6.65685C0.538408 7.04738 0.538408 7.68054 0.928932 8.07107C1.31946 8.46159 1.95262 8.46159 2.34315 8.07107L8 2.41421L13.6569 8.07107C14.0474 8.46159 14.6805 8.46159 15.0711 8.07107C15.4616 7.68054 15.4616 7.04738 15.0711 6.65685L8.70711 0.292893ZM9 18L9 1H7L7 18H9Z"
                                        class="fill-gray-800 group-hover:fill-gray-800"
                                ></path>
                            </svg>
                        </button>

                        <!-- Chart container -->
                        <div id="chartContainer" class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 mt-5 ">
                            <h2 class="text-2xl font-bold mb-4 text-center" th:text="${periodLabel2Description}">Expense Trend</h2>
                            <canvas id="expenseChart" class="w-full h-80 animate-fade-in-slow">

                            </canvas>


                        </div>
                        <div class="mt-5 mr-5 ml-5 " id="expenseTable-lineChart"  >
                            <table class="min-w-full h-auto bg-white border border-gray-200 shadow-md rounded-xl text-sm text-center">
                                <thead class="bg-gray-100 text-gray-700">
                                <tr>
                                    <th class="py-2 px-4 border-b text-xl font-extrabold"
                                        th:text="${period} == 'monthly' ? 'Month' : (${period} == 'quarterly' ? 'Quarter' : (${period} == 'yearly' ? 'Year' : 'Month'))">
                                        Month
                                    </th>
                                    <th class="py-2 px-4 border-b text-green-600 text-xl font-extrabold">Income</th>
                                    <th class="py-2 px-4 border-b text-red-600 text-xl font-extrabold">Expense</th>
                                </tr>
                                </thead>
                                <tbody class="text-gray-700" >
                                <!-- Rows will be added by JavaScript -->
                                </tbody>
                            </table>
                        </div>



                        <script th:inline="javascript">
                            const chartData = {

                                income: /*[[${income}]]*/ [],
                                expense: /*[[${expense}]]*/ []
                            };

                            if ([[${period}]] === 'monthly') {

                                chartData.xValue = /*[[${month}]]*/ [];
                            } else if ([[${period}]] === 'quarterly') {

                                chartData.xValue = /*[[${quarter}]]*/ [];
                            } else if ([[${period}]] === 'yearly') {

                               chartData.xValue = /*[[${year}]]*/ [];
                            }

                            console.log(chartData.xValue);

                        </script>






                    </div>
                </div>
                <!-- Category Breakdown -->
                <div class="mb-6 animate-fade-in-slow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        Category Breakdown
                    </h2>
                    <div class="flex justify-between items-center mb-4">
                        <div class="bg-white p-4 rounded shadow flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <i class="fas fa-chart-pie text-teal-400">
                                </i>
                                <span class="text-gray-600 font-bold"> Spending by Category  </span>
                            </div>
                            <div class="text-gray-500" th:text="${periodLabel3Description}">
                                Pie chart showing distribution of expenses across categories
                            </div>

                            <button  id="toggleChartBtnCategory"
                                     type="submit"
                                     class="flex justify-center gap-2 mt-2 items-center shadow-lg text-base bg-gray-200 backdrop-blur-md font-semibold isolation-auto border-gray-50 relative z-10 px-3.5 py-1.5 overflow-hidden border-2 rounded-full group
    before:absolute before:w-full before:transition-all before:duration-700 before:hover:w-full before:-left-full before:hover:left-0
    before:rounded-full before:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] before:-z-10 before:aspect-square before:hover:scale-150"
                            >
                                <span id="togglePieChartText">Click to hide</span>
                                <svg
                                        class="w-6 h-6 justify-end group-hover:rotate-90 group-hover:bg-gray-50 text-gray-50 ease-linear duration-300 rounded-full border border-gray-700 group-hover:border-none p-1.5 rotate-45"
                                        viewBox="0 0 16 19"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                            d="M7 18C7 18.5523 7.44772 19 8 19C8.55228 19 9 18.5523 9 18H7ZM8.70711 0.292893C8.31658 -0.0976311 7.68342 -0.0976311 7.29289 0.292893L0.928932 6.65685C0.538408 7.04738 0.538408 7.68054 0.928932 8.07107C1.31946 8.46159 1.95262 8.46159 2.34315 8.07107L8 2.41421L13.6569 8.07107C14.0474 8.46159 14.6805 8.46159 15.0711 8.07107C15.4616 7.68054 15.4616 7.04738 15.0711 6.65685L8.70711 0.292893ZM9 18L9 1H7L7 18H9Z"
                                            class="fill-gray-800 group-hover:fill-gray-800"
                                    ></path>
                                </svg>
                            </button>

                            <div id="CategoryChartContainer" class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-6 mt-5 ">
                                <h2 class="text-2xl font-bold mb-4 text-center" >Distribution of Expenses</h2>
                                <canvas id="categoryExpenseChart" class="w-full h-600 animate-fade-in-slow">

                                </canvas>

                            </div>

                            <div class="mt-5 mr-5 ml-5 " id="expenseTable-pieChart"  >
                                <table class="min-w-full h-auto bg-white border border-gray-200 shadow-md rounded-xl text-sm text-center">
                                    <thead class="bg-gray-100 text-gray-700">
                                    <tr>

                                        <th class="py-2 px-4 border-b  text-xl font-extrabold">Category</th>
                                        <th class="py-2 px-4 border-b  text-xl font-extrabold">Total amount spend</th>
                                    </tr>
                                    </thead>
                                    <tbody class="text-gray-700" >
                                    <!-- Rows will be added by JavaScript -->
                                    </tbody>
                                </table>
                            </div>





                            <script th:inline="javascript">
                                const chartDataCategory = {
                                    category: /*[[${categories}]]*/,
                                    expense: /*[[${expenses}]]*/
                                };

                               console.log(chartDataCategory);
                            </script>




                        </div>


                    </div>
                </div>


                <!-- Top Spending Categories -->
                <div class="mb-6 animate-fade-in-slow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        Top Spending Categories
                    </h2>

                    <div class="mt-5 animate-fade-in-slow" th:if="${currentCategorySums != null}">

                        <!-- Header Bar -->
                        <div class="bg-gray-100 p-3 rounded-t-2xl border border-b-0 border-gray-300 font-semibold text-gray-700 text-sm flex justify-between">
                            <div class="w-1/3">Expense Category</div>
                            <div class="w-1/3 text-center">Total Amount Spend </div>
                            <div class="w-1/3 text-right">% of Total Expense</div>
                        </div>

                        <!-- Category Cards -->
                        <div th:each="entry : ${currentCategorySums}"
                             class="bg-white p-4 rounded-b-2xl border-t-0 border border-gray-300 shadow-md hover:shadow-lg transition mb-3 flex justify-between items-center">

                            <!-- Column 1: Category Name -->
                            <div class="w-1/3">
                                <p class="text-gray-800 font-semibold" th:text="${entry.key}">Category Name</p>
                            </div>

                            <!-- Column 2: Total Spend -->
                            <div class="w-1/3 text-center">
                                <p class="text-gray-800 font-medium"
                                   th:text="'₹' + ${#numbers.formatDecimal(entry.value, 1, 'COMMA', 2, 'POINT')}">
                                    ₹0.00
                                </p>
                            </div>

                            <!-- Column 3: % of Total -->
                            <div class="w-1/3 text-right">
                                <p class="text-gray-800"
                                   th:text="${#numbers.formatDecimal((entry.value / totalExpenseByUser) * 100, 1, 'POINT', 2, 'POINT')} + '%'">
                                    0.00%
                                </p>
                            </div>

                        </div>
                    </div>

                </div>



                <!-- Report Actions -->
                <div class="flex space-x-4 animate-fade-in-slow">
                    <form th:action="@{/user/export-pdf}" method="get" id="pdfExportForm>">

                        <input type="hidden" name="period" th:value="${period}" />
                        <button id="exportPdf"
                                type="submit"
                                class="flex justify-center gap-2 mt-2 items-center shadow-lg text-base bg-gray-200 backdrop-blur-md font-semibold isolation-auto border-gray-50 relative z-10 px-3.5 py-1.5 overflow-hidden border-2 rounded-full group
    before:absolute before:w-full before:transition-all before:duration-700 before:hover:w-full before:-left-full before:hover:left-0
    before:rounded-full before:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] before:-z-10 before:aspect-square before:hover:scale-150"
                        >
                            Export PDF
                            <svg
                                    class="w-6 h-6 justify-end group-hover:rotate-90 group-hover:bg-gray-50 text-gray-50 ease-linear duration-300 rounded-full border border-gray-700 group-hover:border-none p-1.5 rotate-45"
                                    viewBox="0 0 16 19"
                                    xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                        d="M7 18C7 18.5523 7.44772 19 8 19C8.55228 19 9 18.5523 9 18H7ZM8.70711 0.292893C8.31658 -0.0976311 7.68342 -0.0976311 7.29289 0.292893L0.928932 6.65685C0.538408 7.04738 0.538408 7.68054 0.928932 8.07107C1.31946 8.46159 1.95262 8.46159 2.34315 8.07107L8 2.41421L13.6569 8.07107C14.0474 8.46159 14.6805 8.46159 15.0711 8.07107C15.4616 7.68054 15.4616 7.04738 15.0711 6.65685L8.70711 0.292893ZM9 18L9 1H7L7 18H9Z"
                                        class="fill-gray-800 group-hover:fill-gray-800"
                                ></path>
                            </svg>
                        </button>
                    </form>



                    <button
                            type="submit"
                            class="flex justify-center gap-2 mt-2 items-center shadow-lg text-base bg-gray-200 backdrop-blur-md font-semibold isolation-auto border-gray-50 relative z-10 px-3.5 py-1.5 overflow-hidden border-2 rounded-full group
    before:absolute before:w-full before:transition-all before:duration-700 before:hover:w-full before:-left-full before:hover:left-0
    before:rounded-full before:bg-[linear-gradient(to_right,_#c2edda,_#a0d6d2)] before:-z-10 before:aspect-square before:hover:scale-150"
                    >
                        Email Report
                        <svg
                                class="w-6 h-6 justify-end group-hover:rotate-90 group-hover:bg-gray-50 text-gray-50 ease-linear duration-300 rounded-full border border-gray-700 group-hover:border-none p-1.5 rotate-45"
                                viewBox="0 0 16 19"
                                xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                    d="M7 18C7 18.5523 7.44772 19 8 19C8.55228 19 9 18.5523 9 18H7ZM8.70711 0.292893C8.31658 -0.0976311 7.68342 -0.0976311 7.29289 0.292893L0.928932 6.65685C0.538408 7.04738 0.538408 7.68054 0.928932 8.07107C1.31946 8.46159 1.95262 8.46159 2.34315 8.07107L8 2.41421L13.6569 8.07107C14.0474 8.46159 14.6805 8.46159 15.0711 8.07107C15.4616 7.68054 15.4616 7.04738 15.0711 6.65685L8.70711 0.292893ZM9 18L9 1H7L7 18H9Z"
                                    class="fill-gray-800 group-hover:fill-gray-800"
                            ></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>



</section>



<div th:fragment="scripts">

    <script type="text/javascript" th:src="@{/javascript/reports-page-script.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</div>


</body>
</html>