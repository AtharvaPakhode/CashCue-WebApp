<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base-page-user-access::layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Income History</title>

    <div th:replace="~{base-page-user-access :: styles-income-history}" />
</head>
<body>

<section class="bg-gray-50 text-gray-800">
    <div class="flex dynamic-content min-h-screen">

        <!-- Main Content -->
        <div class="flex-1 p-6">

            <!-- Recent Incomes -->
            <div class="mt-6">

                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Recent Incomes</h2>

                    <button class="text-black px-4 py-2 rounded" id="filterTransactions">
                        Filter Incomes
                    </button>
                </div>

                <form id="filterForm"class="space-y-6 mt-3" th:action="@{/user/income-history/0}" method="get">


                    <div>
                        <label class="block text-lg font-semibold mb-2">
                            Amount Range
                        </label>
                        <div class="flex space-x-4">
                            <div class="flex-1">
                                <label class="block text-sm mb-1">
                                    Minimum Amount
                                </label>
                                <input name="minAmount" class="w-full p-2 border border-gray-300 rounded bg-gray-50" type="number" />
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm mb-1">
                                    Maximum Amount
                                </label>
                                <input name="maxAmount" class="w-full p-2 border border-gray-300 rounded bg-gray-50" type="number" />
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-lg font-semibold mb-2">
                            Date Range
                        </label>
                        <div class="flex space-x-4">
                            <div class="flex-1">
                                <label class="block text-sm mb-1">Start Date</label>
                                <input name="startDate" class="w-full p-2 border border-gray-300 rounded bg-gray-50" type="date" />
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm mb-1">End Date</label>
                                <input name="endDate" class="w-full p-2 border border-gray-300 rounded bg-gray-50" type="date" />
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button class="text-black px-4 py-2 rounded" type="submit" id="applyFilters">
                            Apply Filters
                        </button>
                        <button class="border border-gray-300 text-gray-700 px-4 py-2 rounded" type="reset">
                            Reset
                        </button>
                    </div>

                </form>

                <div class="mt-3" th:if="${userTransactions != null}">
                    <div class="space-y-4" th:each="income : ${userTransactions}">

                        <!-- Each income box -->
                        <div class="bg-white p-4 rounded-lg shadow flex justify-between items-center mt-2">

                            <!-- Left: Source and Date -->
                            <div class="flex items-center space-x-4">
                                <div>
                                    <p class="text-gray-800 font-bold" th:text="${income.source}">Income Source</p>
                                    <p class="text-gray-500" th:text="${#temporals.format(income.localDateTime, 'MMMM dd, yyyy')}">Income Date</p>
                                </div>
                            </div>

                            <!-- Right: Amount -->
                            <div class="flex items-center space-x-4">
                                <p class="font-semibold text-green-600" th:text="'₹' + ${income.amount}">+₹0.00</p>
                            </div>

                        </div>

                    </div>
                </div>

                <!-- Pagination -->
                <nav class="mt-6 flex justify-center" th:if="${totalPages > 0}">
                    <ul class="flex space-x-2">

                        <!-- Previous Page -->
                        <li th:if="${currentPage > 0}">
                            <a th:href="@{/user/income-history/{page}(page=${currentPage - 1},
                minAmount=${minAmount},
                maxAmount=${maxAmount},
                paymentMethod=${paymentMethod},
                startDate=${startDate},
                endDate=${endDate})}"
                               class="page-link px-3 py-1 rounded"
                               style="background-color:#c2edda; color:black">
                                &laquo;
                            </a>
                        </li>

                        <!-- Page Numbers -->
                        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${i == currentPage} ? 'font-bold underline'">
                            <a th:href="@{/user/income-history/{page}(page=${i},
                minAmount=${minAmount},
                maxAmount=${maxAmount},
                paymentMethod=${paymentMethod},
                startDate=${startDate},
                endDate=${endDate})}"
                               class="page-link px-3 py-1 rounded"
                               style="background-color:#c2edda; color:black">
                                <span th:text="${i + 1}"></span>
                            </a>
                        </li>

                        <!-- Next Page -->
                        <li th:if="${currentPage + 1 < totalPages}">
                            <a th:href="@{/user/income-history/{page}(page=${currentPage + 1},
                minAmount=${minAmount},
                maxAmount=${maxAmount},
                paymentMethod=${paymentMethod},
                startDate=${startDate},
                endDate=${endDate})}"
                               class="page-link px-3 py-1 rounded"
                               style="background-color:#c2edda; color:black">
                                &raquo;
                            </a>
                        </li>

                    </ul>
                </nav>

                <div th:if="${totalPages == 0}" class="text-center text-gray-500">
                    No Incomes found
                </div>

            </div>
        </div>
    </div>
</section>

<div th:fragment="scripts">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" th:src="@{/javascript/income-history-script.js}"></script>
</div>

</body>
</html>
