<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base-page-user-access::layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>



</head>
<body>

<section class="bg-gray-50 text-gray-800">
<div class="flex  dynamic-content min-h-screen">


  <!-- Main Content -->
  <div class="flex-1 p-6">




    <!-- Recent Transactions -->
    <div class="mt-6" >

      <div class="flex justify-between items-center">
        <h2 class="text-xl font-bold">Recent Transactions</h2>

        <button class=" text-black px-4 py-2 rounded " id="filterTransactions">
          Filter Transactions
        </button>

      </div>




      <form class="space-y-6 mt-3" id="filterForm" th:object="${userCategories}" th:action="@{/user/expense-history/0}" method="get">



        <label class="block text-lg font-semibold mb-2">
          Category
        </label>

        <div class="max-h-20 overflow-y-auto space-y-2 pr-1 custom-scroll">
          <div th:each="category : ${userCategories}" class="checkbox-wrapper-46">
            <input type="checkbox"
                   th:id="'cbx-46-' + ${category.categoryName}"
                   class="inp-cbx"
                   th:name="categories"
                   th:value="${category.categoryName}" />

            <label th:for="'cbx-46-' + ${category.categoryName}" class="cbx">
      <span>
        <svg viewBox="0 0 12 10" height="10px" width="12px">
          <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
        </svg>
      </span>
              <span th:text="${category.categoryName}">Category Name</span>
            </label>
          </div>
        </div>




        <div>
          <label class="block text-lg font-semibold mb-2">
            Payment Method
          </label>
          <select  name="paymentMethod" class="w-full p-2 border border-gray-300 rounded bg-gray-50">
            <option value="">Select payment method</option> <!-- Sends null to backend -->
            <option value="CASH">Cash</option>
            <option value="UPI">UPI</option>
            <option value="NET_BANKING">Net Banking</option>
            <option value="CREDIT_CARD">Credit Card</option>
            <option value="DEBIT_CARD">Debit Card</option>
          </select>
        </div>


        <div>
          <label class="block text-lg font-semibold mb-2">
            Amount Range
          </label>
          <div class="flex space-x-4">
            <div class="flex-1">
              <label class="block text-sm mb-1">
                Minimum Amount
              </label>
              <div class="flex items-center">
                <input  name="minAmount" class="w-full p-2 border border-gray-300 rounded bg-gray-50" type="number"/>
              </div>
            </div>
            <div class="flex-1">
              <label class="block text-sm mb-1">
                Maximum Amount
              </label>
              <div class="flex items-center">
                <input name="maxAmount" class="w-full p-2 border border-gray-300 rounded bg-gray-50" type="number"/>
              </div>
            </div>
          </div>
        </div>


        <div>
          <label class="block text-lg font-semibold mb-2">
            Date Range
          </label>
          <div class="flex space-x-4">
            <div class="flex-1">
              <label class="block text-sm mb-1">
                Start Date
              </label>
              <div class="flex items-center">
                <input  name="startDate" class="w-full p-2 border border-gray-300 rounded bg-gray-50" placeholder="MM/DD/YYYY" type="date"/>

              </div>
            </div>
            <div class="flex-1">
              <label class="block text-sm mb-1">
                End Date
              </label>
              <div class="flex items-center">
                <input  name="endDate" class="w-full p-2 border border-gray-300 rounded bg-gray-50" placeholder="MM/DD/YYYY" type="date"/>

              </div>
            </div>
          </div>
        </div>


        <div class="flex space-x-4">
          <button class="text-black px-4 py-2 rounded" type="submit" id="applyFilters">
            Apply Filters
          </button>
          <button class="border border-gray-300 text-gray-700 px-4 py-2 rounded" type="reset">
            Reset
          </button>
        </div>


      </form>


      <div class="mt-3" th:if="${userTransactions != null}">
        <div class="space-y-4" th:each="transaction : ${userTransactions}">

          <!-- Each transaction box -->
          <div class="bg-white p-4 rounded-lg shadow flex justify-between items-center mt-2">

            <!-- Left: Title and Date -->
            <div class="flex items-center space-x-4">
              <div>
                <p class="text-gray-800 font-bold" th:text="${transaction.name}">Expense Title</p>
                <p class="text-gray-500" th:text="${#temporals.format(transaction.localDateTime, 'MMMM dd, yyyy')}">Expense Date</p>
              </div>
            </div>

            <!-- Right: Category and Amount -->
            <div class="flex items-center space-x-4">
              <p class="text-gray-500" th:text="${transaction.category.categoryName}">Category Name</p>
              <p class="font-semibold text-red-600" th:text="${transaction.amount}">-$0.00</p>
            </div>

          </div>

        </div>
      </div>


      <nav class="mt-6 flex justify-center" th:if="${totalPages > 0}">
        <ul class="flex space-x-2">

          <!-- Previous Page -->
          <li th:if="${currentPage > 0}">
            <a th:href="@{/user/expense-history/{page}(page=${currentPage - 1},
                categories=${filterCategories},
                minAmount=${minAmount},
                maxAmount=${maxAmount},
                paymentMethod=${paymentMethod},
                startDate=${startDate},
                endDate=${endDate})}"
               class="page-link px-3 py-1 rounded"
               style="background-color:#c2edda; color:black">
              &laquo;
            </a>
          </li>

          <!-- Page Numbers -->
          <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
              th:classappend="${i == currentPage} ? 'font-bold underline'">
            <a th:href="@{/user/expense-history/{page}(page=${i},
                categories=${filterCategories},
                minAmount=${minAmount},
                maxAmount=${maxAmount},
                paymentMethod=${paymentMethod},
                startDate=${startDate},
                endDate=${endDate})}"
               class="page-link px-3 py-1 rounded"
               style="background-color:#c2edda; color:black">
              <span th:text="${i + 1}"></span>
            </a>
          </li>

          <!-- Next Page -->
          <li th:if="${currentPage + 1 < totalPages}">
            <a th:href="@{/user/expense-history/{page}(page=${currentPage + 1},
                categories=${filterCategories},
                minAmount=${minAmount},
                maxAmount=${maxAmount},
                paymentMethod=${paymentMethod},
                startDate=${startDate},
                endDate=${endDate})}"
               class="page-link px-3 py-1 rounded"
               style="background-color:#c2edda; color:black">
              &raquo;
            </a>
          </li>

        </ul>
      </nav>



      <div th:if="${totalPages == 0}" class="text-center text-gray-500">
        No Transactions found
      </div>


    </div>
  </div>
</div>
</section>

<div th:fragment="scripts">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript" th:src="@{/javascript/expense-history-script.js}"  ></script>
</div>

</body>

</html>